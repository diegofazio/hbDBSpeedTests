/* $Id$ */

     letobackup - утилита, предназначенная для создания копии БД в произвольный
момент времени. Перед созданием архива выполняется попытка блокировки сервера.
Если сервер letodb заблокирован, то не допускаются операции модификации БД:
блокировка записи или файла, запись данных, добавление записей, создание
индексов и таблиц. Попытка блокировки заключается в ожидании завершения всех
начатых операций модификации данных. Если в течении указанного промежутка
времени (таймаута) не все такие операции завершились, то сервер не блокируется.
Сервер блокируется на время создания копии БД. После завершения копирования БД
сервер разблокируется. Блокировка сервера необходима для обеспечения
целостности БД. Возможно указать режим, когда перед созданием копии БД попытка
блокировки сервера не выполняется, и режим, когда копия БД создается и в том
случае, когда блокировка сервера не удалась. В этом случае целостность данных
не будет гарантирована.
     letobackup должна запускаться на сервере. При первом запуске утилиты
копируется вся БД, при последующих запусках - только изменившиеся данные.
После копирования данных можно запустить внешний архиватор для создания архива
БД.

     Ниже приведены параметры letobackup, которые находятся в файле letbbackup.ini.

# Строка соединения с сервером

Server   = //127.0.0.1:2812

# Полный путь к БД на сервере. Этот путь должен совпадать с параметром,
# DataPath в файле letodb.ini. Для ОС Windows должен указываться обратный
# слэш "\"

DataPath = c:\database

# Каталог БД для создания копии. Каталог задается относительно каталога,
# указанного в DataPath. Если копируется вся БД, то необходимо указать значение
# "/". В имени каталога должен использоваться прямой слэш "/"

DataBase = /data1/

# Каталог, в котором создается копия БД. Должен указываться прямой слэш "\"

Backup   = c:\backup\

# Маски файлов для копирования. Маски указываются через запятую. Копируются
# только файлы, удовлетворяющие заданным маскам.

Mask     = *.dbf,*.fpt,*.dbt

# Если указано значение Lock=1, перед созданием архива выполняется попытка
# блокировки сервера

Lock     = 1

# Время в секундах, в течение которого архива выполняется попытка блокировки
# сервера, по умолчанию - 30 секунд

Seconds  = 30

# Если указано значение Wait=1, для создания копии необходима успешная
# блокировка сервера. Если значение параметра не указано, копия будет создана
# в любом случае

Wait     = 1

# Командная строка для запуска внешнего архиватора, который запускается после
# создания копии. Символы %dt% в строке будут заменены на текущую дату,
# а символы %tm% - на текущее время.

ArcCmd   = "C:\Program files\7-zip\7z.exe" a -r c:\arc\data%dt%_%tm% c:\backup\*.*
